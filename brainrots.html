<script>
const productsDiv = document.getElementById("products");
let cart = [], total = 0, pedidosPendentes = 0;

/* ðŸ”¥ 10 PRODUTOS */
const produtos = [
  { nome: "Brainrot 1,4b", preco: 55, img: "brainrot1.png", estoque: 5 },
  { nome: "Brainrot 1,2b", preco: 50, img: "brainrot2.png", estoque: 4 },
  { nome: "Brainrot 1,0b", preco: 45, img: "brainrot3.png", estoque: 3 },
  { nome: "Brainrot 900m", preco: 40, img: "brainrot4.png", estoque: 6 },
  { nome: "Brainrot 800m", preco: 35, img: "brainrot5.png", estoque: 5 },
  { nome: "Brainrot 700m", preco: 30, img: "brainrot6.png", estoque: 4 },
  { nome: "Brainrot 600m", preco: 28, img: "brainrot7.png", estoque: 3 },
  { nome: "Brainrot 500m", preco: 25, img: "brainrot8.png", estoque: 5 },
  { nome: "Brainrot 400m", preco: 22, img: "brainrot9.png", estoque: 2 },
  { nome: "Brainrot 300m", preco: 20, img: "brainrot10.png", estoque: 7 }
];

/* CRIAR PRODUTOS */
produtos.forEach((produto, index) => {

  if (localStorage.getItem("stock" + index) === null) {
    localStorage.setItem("stock" + index, produto.estoque);
  }

  productsDiv.innerHTML += `
    <div class="card">
      <div class="sold-out" id="sold${index}">ESGOTADO</div>
      <img src="images/${produto.img}">
      <div class="card-content">
        <div>${produto.nome}</div>
        <div class="price">R$${produto.preco}</div>
        <div class="stock" id="stock${index}"></div>
        <button class="buy-btn" onclick="buy(${index})">Comprar</button>
      </div>
    </div>
  `;

  updateStock(index);
});

/* ESTOQUE */
function updateStock(id) {
  let stock = parseInt(localStorage.getItem("stock" + id));
  let el = document.getElementById("stock" + id);
  let sold = document.getElementById("sold" + id);

  if (stock > 0) {
    el.innerText = "Restam " + stock + " unidades";
    el.style.color = "#00ff88";
    sold.style.display = "none";
  } else {
    el.innerText = "Produto esgotado";
    el.style.color = "red";
    sold.style.display = "flex";
  }
}

/* COMPRAR */
function buy(id) {
  let stock = parseInt(localStorage.getItem("stock" + id));
  if (stock > 0) {
    stock--;
    localStorage.setItem("stock" + id, stock);
    updateStock(id);
    cart.push(produtos[id].nome);
    total += produtos[id].preco;
    updateCart();
  }
}

/* CARRINHO */
function updateCart() {
  const cartItems = document.getElementById("cartItems");
  cartItems.innerHTML = "";
  cart.forEach((item, index) => {
    cartItems.innerHTML += `
      <div class="cart-item">
        ${item}
        <button class="remove-btn" onclick="removeItem(${index})">ðŸ—‘</button>
      </div>`;
  });
  document.getElementById("total").innerText =
    "Total: R$" + total.toFixed(2);
}

function removeItem(index) {
  total -= produtos.find(p => p.nome === cart[index]).preco;
  cart.splice(index, 1);
  updateCart();
}

/* ABRIR / FECHAR */
function toggleCart() {
  document.getElementById("cart").classList.toggle("active");
}
function fecharCarrinho() {
  document.getElementById("cart").classList.remove("active");
}
</script>
